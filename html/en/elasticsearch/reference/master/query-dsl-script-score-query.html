<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Script score query
        | Elasticsearch Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="specialized-queries.html" title="Specialized queries" /><link rel="prev" href="query-dsl-script-query.html" title="Script query" /><link rel="next" href="query-dsl-wrapper-query.html" title="Wrapper query" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="specialized-queries.html">Specialized queries</a></span> » <span class="breadcrumb-node">Script score query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-script-query.html">
              « 
              Script query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-wrapper-query.html">Wrapper query
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-script-score-query"></a>Script score query<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">script_score</code> allows you to modify the score of documents that are
retrieved by a query. This can be useful if, for example, a score
function is computationally expensive and it is sufficient to compute
the score on a filtered set of documents.</p><p>To use <code class="literal">script_score</code>, you have to define a query and a script -
a function to be used to compute a new score for each document returned
by the query. For more information on scripting see
<a class="link" href="modules-scripting.html" title="Scripting">scripting documentation</a>.</p><p>Here is an example of using <code class="literal">script_score</code> to assign each matched document
a score equal to the number of likes divided by 10:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET /_search
{
    "query" : {
        "script_score" : {
            "query" : {
                "match": { "message": "elasticsearch" }
            },
            "script" : {
                "source" : "doc['likes'].value / 10 "
            }
        }
     }
}</pre></div><div class="console_widget" data-snippet="snippets/451.console"></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The values returned from <code class="literal">script_score</code> cannot be negative. In general,
Lucene requires the scores produced by queries to be non-negative in order to
support certain search optimizations.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_accessing_the_score_of_a_document_within_a_script"></a>Accessing the score of a document within a script<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Within a script, you can
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-fields.html#scripting-score" target="_top">access</a>
the <code class="literal">_score</code> variable which represents the current relevance score of a
document.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_predefined_functions_within_a_painless_script"></a>Predefined functions within a Painless script<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You can use any of the available
<a class="link" href="painless-api-reference.html" title="Painless Contexts API Reference">painless functions</a> in the painless script.
Besides these functions, there are a number of predefined functions
that can help you with scoring. We suggest you to use them instead of
rewriting equivalent functions of your own, as these functions try
to be the most efficient by using the internal mechanisms.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_saturation_2"></a>saturation<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p><code class="literal">saturation(value,k) = value/(k + value)</code></p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "saturation(doc['likes'].value, 1)"
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_sigmoid_2"></a>sigmoid<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p><code class="literal">sigmoid(value, k, a) = value^a/ (k^a + value^a)</code></p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "sigmoid(doc['likes'].value, 2, 1)"
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="random-score-function"></a>Random score function<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p><code class="literal">random_score</code> function generates scores that are uniformly distributed
from 0 up to but not including 1.</p><p><code class="literal">randomScore</code> function has the following syntax:
<code class="literal">randomScore(&lt;seed&gt;, &lt;fieldName&gt;)</code>.
It has a required parameter - <code class="literal">seed</code> as an integer value,
and an optional parameter - <code class="literal">fieldName</code> as a string value.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "randomScore(100, '_seq_no')"
}</pre></div><p>If the <code class="literal">fieldName</code> parameter is omitted, the internal Lucene
document ids will be used as a source of randomness. This is very efficient,
but unfortunately not reproducible since documents might be renumbered
by merges.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "randomScore(100)"
}</pre></div><p>Note that documents that are within the same shard and have the
same value for field will get the same score, so it is usually desirable
to use a field that has unique values for all documents across a shard.
A good default choice might be to use the <code class="literal">_seq_no</code>
field, whose only drawback is that scores will change if the document is
updated since update operations also update the value of the <code class="literal">_seq_no</code> field.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="decay-functions-numeric-fields"></a>Decay functions for numeric fields<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>You can read more about decay functions
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl-function-score-query.html#function-decay" target="_top">here</a>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">double decayNumericLinear(double origin, double scale, double offset, double decay, double docValue)</code></li><li class="listitem"><code class="literal">double decayNumericExp(double origin, double scale, double offset, double decay, double docValue)</code></li><li class="listitem"><code class="literal">double decayNumericGauss(double origin, double scale, double offset, double decay, double docValue)</code></li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "decayNumericLinear(params.origin, params.scale, params.offset, params.decay, doc['dval'].value)",
    "params": { <a id="CO138-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "origin": 20,
        "scale": 10,
        "decay" : 0.5,
        "offset" : 0
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO138-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Using <code class="literal">params</code> allows to compile the script only once, even if params change.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_decay_functions_for_geo_fields"></a>Decay functions for geo fields<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">double decayGeoLinear(String originStr, String scaleStr, String offsetStr, double decay, GeoPoint docValue)</code></li><li class="listitem"><code class="literal">double decayGeoExp(String originStr, String scaleStr, String offsetStr, double decay, GeoPoint docValue)</code></li><li class="listitem"><code class="literal">double decayGeoGauss(String originStr, String scaleStr, String offsetStr, double decay, GeoPoint docValue)</code></li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "decayGeoExp(params.origin, params.scale, params.offset, params.decay, doc['location'].value)",
    "params": {
        "origin": "40, -70.12",
        "scale": "200km",
        "offset": "0km",
        "decay" : 0.2
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_decay_functions_for_date_fields"></a>Decay functions for date fields<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">double decayDateLinear(String originStr, String scaleStr, String offsetStr, double decay, JodaCompatibleZonedDateTime docValueDate)</code></li><li class="listitem"><code class="literal">double decayDateExp(String originStr, String scaleStr, String offsetStr, double decay, JodaCompatibleZonedDateTime docValueDate)</code></li><li class="listitem"><code class="literal">double decayDateGauss(String originStr, String scaleStr, String offsetStr, double decay, JodaCompatibleZonedDateTime docValueDate)</code></li></ul></div><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "decayDateGauss(params.origin, params.scale, params.offset, params.decay, doc['date'].value)",
    "params": {
        "origin": "2008-01-01T01:00:00Z",
        "scale": "1h",
        "offset" : "0",
        "decay" : 0.5
    }
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>Decay functions on dates are limited to dates in the default format
and default time zone. Also calculations with <code class="literal">now</code> are not supported.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_functions_for_vector_fields"></a>Functions for vector fields<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p><a class="link" href="query-dsl-script-score-query.html#vector-functions" title="Functions for vector fields">Functions for vector fields</a> are accessible through
<code class="literal">script_score</code> query.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_faster_alternatives"></a>Faster alternatives<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Script Score Query calculates the score for every hit (matching document).
There are faster alternative query types that can efficiently skip
non-competitive hits:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">If you want to boost documents on some static fields, use
<a class="link" href="query-dsl-rank-feature-query.html" title="Rank feature query">Rank Feature Query</a>.</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_transition_from_function_score_query"></a>Transition from Function Score Query<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>We are deprecating <a class="link" href="query-dsl-function-score-query.html" title="Function score query">Function Score</a>, and
Script Score Query will be a substitute for it.</p><p>Here we describe how Function Score Query’s functions can be
equivalently implemented in Script Score Query:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="script-score"></a><code class="literal">script_score</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>What you used in <code class="literal">script_score</code> of the Function Score query, you
can copy into the Script Score query. No changes here.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="weight"></a><code class="literal">weight</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p><code class="literal">weight</code> function can be implemented in the Script Score query through
the following script:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "params.weight * _score",
    "params": {
        "weight": 2
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="random-score"></a><code class="literal">random_score</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Use <code class="literal">randomScore</code> function
as described in <a class="link" href="query-dsl-script-score-query.html#random-score-function" title="Random score function">random score function</a>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="field-value-factor"></a><code class="literal">field_value_factor</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p><code class="literal">field_value_factor</code> function can be easily implemented through script:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "Math.log10(doc['field'].value * params.factor)",
    params" : {
        "factor" : 5
    }
}</pre></div><p>For checking if a document has a missing value, you can use
<code class="literal">doc['field'].size() == 0</code>. For example, this script will use
a value <code class="literal">1</code> if a document doesn’t have a field <code class="literal">field</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"script" : {
    "source" : "Math.log10((doc['field'].size() == 0 ? 1 : doc['field'].value()) * params.factor)",
    params" : {
        "factor" : 5
    }
}</pre></div><p>This table lists how <code class="literal">field_value_factor</code> modifiers can be implemented
through a script:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Modifier</th><th align="left" valign="top">Implementation in Script Score</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="left" valign="top"><p>-</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">log</code></p></td><td align="left" valign="top"><p><code class="literal">Math.log10(doc['f'].value)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">log1p</code></p></td><td align="left" valign="top"><p><code class="literal">Math.log10(doc['f'].value + 1)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">log2p</code></p></td><td align="left" valign="top"><p><code class="literal">Math.log10(doc['f'].value + 2)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ln</code></p></td><td align="left" valign="top"><p><code class="literal">Math.log(doc['f'].value)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ln1p</code></p></td><td align="left" valign="top"><p><code class="literal">Math.log(doc['f'].value + 1)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ln2p</code></p></td><td align="left" valign="top"><p><code class="literal">Math.log(doc['f'].value + 2)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">square</code></p></td><td align="left" valign="top"><p><code class="literal">Math.pow(doc['f'].value, 2)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">sqrt</code></p></td><td align="left" valign="top"><p><code class="literal">Math.sqrt(doc['f'].value)</code></p></td></tr><tr><td align="left" valign="top"><p><code class="literal">reciprocal</code></p></td><td align="left" valign="top"><p><code class="literal">1.0 / doc['f'].value</code></p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="decay-functions"></a><code class="literal">decay functions</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/script-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Script Score query has equivalent <a class="link" href="query-dsl-script-score-query.html#decay-functions" title="decay functions">decay functions</a>
that can be used in script.</p></div><div class="xpack section"><div class="titlepage"><div><div><h4 class="title"><a id="vector-functions"></a>Functions for vector fields<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/vectors/vector-functions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a><a class="xpack_tag" href="/subscriptions"></a></h4></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>These functions are used for
for <a class="link" href="dense-vector.html" title="Dense vector datatype"><code class="literal">dense_vector</code></a>  and
<a class="link" href="sparse-vector.html" title="Sparse vector datatype"><code class="literal">sparse_vector</code></a> fields.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>During vector functions' calculation, all matched documents are
linearly scanned. Thus, expect the query time grow linearly
with the number of matched documents. For this reason, we recommend
to limit the number of matched documents with a <code class="literal">query</code> parameter.</p></div></div><p>Let’s create an index with the following mapping and index a couple
of documents into it.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">PUT my_index
{
  "mappings": {
    "properties": {
      "my_dense_vector": {
        "type": "dense_vector",
        "dims": 3
      },
      "my_sparse_vector" : {
        "type" : "sparse_vector"
      }
    }
  }
}

PUT my_index/_doc/1
{
  "my_dense_vector": [0.5, 10, 6],
  "my_sparse_vector": {"2": 1.5, "15" : 2, "50": -1.1, "4545": 1.1}
}

PUT my_index/_doc/2
{
  "my_dense_vector": [-0.5, 10, 10],
  "my_sparse_vector": {"2": 2.5, "10" : 1.3, "55": -2.3, "113": 1.6}
}</pre></div><div class="console_widget" data-snippet="snippets/452.console"></div><p>For dense_vector fields, <code class="literal">cosineSimilarity</code> calculates the measure of
cosine similarity between a given query vector and document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "cosineSimilarity(params.query_vector, doc['my_dense_vector']) + 1.0", <a id="CO139-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "params": {
          "query_vector": [4, 3.4, -0.2]  <a id="CO139-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/453.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO139-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>The script adds 1.0 to the cosine similarity to prevent the score from being negative.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO139-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>To take advantage of the script optimizations, provide a query vector as a script parameter.</p></td></tr></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If a document’s dense vector field has a number of dimensions
different from the query’s vector, an error will be thrown.</p></div></div><p>Similarly, for sparse_vector fields, <code class="literal">cosineSimilaritySparse</code> calculates cosine similarity
between a given query vector and document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "cosineSimilaritySparse(params.query_vector, doc['my_sparse_vector']) + 1.0",
        "params": {
          "query_vector": {"2": 0.5, "10" : 111.3, "50": -1.3, "113": 14.8, "4545": 156.0}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/454.console"></div><p>For dense_vector fields, <code class="literal">dotProduct</code> calculates the measure of
dot product between a given query vector and document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": """
          double value = dotProduct(params.query_vector, doc['my_dense_vector']);
          return sigmoid(1, Math.E, -value); <a id="CO140-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        """,
        "params": {
          "query_vector": [4, 3.4, -0.2]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/455.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO140-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Using the standard sigmoid function prevents scores from being negative.</p></td></tr></table></div><p>Similarly, for sparse_vector fields, <code class="literal">dotProductSparse</code> calculates dot product
between a given query vector and document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": """
          double value = dotProductSparse(params.query_vector, doc['my_sparse_vector']);
          return sigmoid(1, Math.E, -value);
        """,
         "params": {
          "query_vector": {"2": 0.5, "10" : 111.3, "50": -1.3, "113": 14.8, "4545": 156.0}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/456.console"></div><p>For dense_vector fields, <code class="literal">l1norm</code> calculates L<sup>1</sup> distance
(Manhattan distance) between a given query vector and
document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "1 / (1 + l1norm(params.queryVector, doc['my_dense_vector']))", <a id="CO141-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "params": {
          "queryVector": [4, 3.4, -0.2]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/457.console"></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO141-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>Unlike <code class="literal">cosineSimilarity</code> that represent similarity, <code class="literal">l1norm</code> and
<code class="literal">l2norm</code> shown below represent distances or differences. This means, that
the more similar the vectors are, the lower the scores will be that are
produced by the <code class="literal">l1norm</code> and <code class="literal">l2norm</code> functions.
Thus, as we need more similar vectors to score higher,
we reversed the output from <code class="literal">l1norm</code> and <code class="literal">l2norm</code>. Also, to avoid
division by 0 when a document vector matches the query exactly,
we added <code class="literal">1</code> in the denominator.</p></td></tr></table></div><p>For sparse_vector fields, <code class="literal">l1normSparse</code> calculates L<sup>1</sup> distance
between a given query vector and document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "1 / (1 + l1normSparse(params.queryVector, doc['my_sparse_vector']))",
        "params": {
          "queryVector": {"2": 0.5, "10" : 111.3, "50": -1.3, "113": 14.8, "4545": 156.0}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/458.console"></div><p>For dense_vector fields, <code class="literal">l2norm</code> calculates L<sup>2</sup> distance
(Euclidean distance) between a given query vector and
document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "1 / (1 + l2norm(params.queryVector, doc['my_dense_vector']))",
        "params": {
          "queryVector": [4, 3.4, -0.2]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/459.console"></div><p>Similarly, for sparse_vector fields, <code class="literal">l2normSparse</code> calculates L<sup>2</sup> distance
between a given query vector and document vectors.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET my_index/_search
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "1 / (1 + l2normSparse(params.queryVector, doc['my_sparse_vector']))",
        "params": {
          "queryVector": {"2": 0.5, "10" : 111.3, "50": -1.3, "113": 14.8, "4545": 156.0}
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/460.console"></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>If a document doesn’t have a value for a vector field on which
a vector function is executed, an error will be thrown.</p></div></div><p>You can check if a document has a value for the field <code class="literal">my_vector</code> by
<code class="literal">doc['my_vector'].size() == 0</code>. Your overall script can look like this:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">"source": "doc['my_vector'].size() == 0 ? 0 : cosineSimilarity(params.queryVector, doc['my_vector'])"</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-script-query.html">
              « 
              Script query</a>
           
        </span><span class="next">
           
          <a href="query-dsl-wrapper-query.html">Wrapper query
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
