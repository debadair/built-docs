<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Intervals query
        | Elasticsearch Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="full-text-queries.html" title="Full text queries" /><link rel="prev" href="full-text-queries.html" title="Full text queries" /><link rel="next" href="query-dsl-match-query.html" title="Match query" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="full-text-queries.html">Full text queries</a></span> » <span class="breadcrumb-node">Intervals query</span></div><div class="navheader"><span class="prev"><a href="full-text-queries.html">
              « 
              Full text queries</a>
           
        </span><span class="next">
           
          <a href="query-dsl-match-query.html">Match query
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-intervals-query"></a>Intervals query<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>An <code class="literal">intervals</code> query allows fine-grained control over the order and proximity of
matching terms.  Matching rules are constructed from a small set of definitions,
and the rules are then applied to terms from a particular <code class="literal">field</code>.</p><p>The definitions produce sequences of minimal intervals that span terms in a
body of text.  These intervals can be further combined and filtered by
parent sources.</p><p>The example below will search for the phrase <code class="literal">my favourite food</code> appearing
before the terms <code class="literal">hot</code> and <code class="literal">water</code> or <code class="literal">cold</code> and <code class="literal">porridge</code> in any order, in
the field <code class="literal">my_text</code></p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "all_of" : {
          "ordered" : true,
          "intervals" : [
            {
              "match" : {
                "query" : "my favourite food",
                "max_gaps" : 0,
                "ordered" : true
              }
            },
            {
              "any_of" : {
                "intervals" : [
                  { "match" : { "query" : "hot water" } },
                  { "match" : { "query" : "cold porridge" } }
                ]
              }
            }
          ]
        },
        "_name" : "favourite_food"
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/323.console"></div><p>In the above example, the text <code class="literal">my favourite food is cold porridge</code> would
match because the two intervals matching <code class="literal">my favourite food</code> and <code class="literal">cold
porridge</code> appear in the correct order, but the text <code class="literal">when it's cold my
favourite food is porridge</code> would not match, because the interval matching
<code class="literal">cold porridge</code> starts before the interval matching <code class="literal">my favourite food</code>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="intervals-match"></a><code class="literal">match</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">match</code> rule matches analyzed text, and takes the following parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">query</code></p>
</td><td valign="top">
<p>The text to match.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">max_gaps</code></p>
</td><td valign="top">
<p>Specify a maximum number of gaps between the terms in the text.  Terms that
appear further apart than this will not match. If unspecified, or set to -1,
then there is no width restriction on the match.  If set to 0 then the terms
must appear next to each other.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">ordered</code></p>
</td><td valign="top">
<p>Whether or not the terms must appear in their specified order.  Defaults to
<code class="literal">false</code></p>
</td></tr><tr><td valign="top">
<p><code class="literal">analyzer</code></p>
</td><td valign="top">
<p>Which analyzer should be used to analyze terms in the <code class="literal">query</code>.  By
default, the search analyzer of the top-level field will be used.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">filter</code></p>
</td><td valign="top">
<p>An optional <a class="link" href="query-dsl-intervals-query.html#interval_filter" title="filters">interval filter</a></p>
</td></tr><tr><td valign="top">
<p><code class="literal">use_field</code></p>
</td><td valign="top">
<p>If specified, then match intervals from this field rather than the top-level field.
Terms will be analyzed using the search analyzer from this field.  This allows you
to search across multiple fields as if they were all the same field; for example,
you could index the same text into stemmed and unstemmed fields, and search for
stemmed tokens near unstemmed ones.</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="intervals-prefix"></a><code class="literal">prefix</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">prefix</code> rule finds terms that start with a specified prefix.  The prefix will
expand to match at most 128 terms; if there are more matching terms in the index,
then an error will be returned.  To avoid this limit, enable the
<a class="link" href="index-prefixes.html" title="index_prefixes"><code class="literal">index-prefixes</code></a> option on the field being searched.</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">prefix</code></p>
</td><td valign="top">
<p>Match terms starting with this prefix</p>
</td></tr><tr><td valign="top">
<p><code class="literal">analyzer</code></p>
</td><td valign="top">
<p>Which analyzer should be used to normalize the <code class="literal">prefix</code>.  By default, the
search analyzer of the top-level field will be used.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">use_field</code></p>
</td><td valign="top">
<p>If specified, then match intervals from this field rather than the top-level field.
The <code class="literal">prefix</code> will be normalized using the search analyzer from this field, unless
<code class="literal">analyzer</code> is specified separately.</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="intervals-wildcard"></a><code class="literal">wildcard</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">wildcard</code> rule finds terms that match a wildcard pattern.  The pattern will
expand to match at most 128 terms; if there are more matching terms in the index,
then an error will be returned.</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">pattern</code></p>
</td><td valign="top">
<p>Find terms matching this pattern</p>
<p>This parameter supports two wildcard operators:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><code class="literal">?</code>, which matches any single character</li><li class="listitem"><code class="literal">*</code>, which can match zero or more characters, including an empty one</li></ul></div>
<div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>Avoid beginning patterns with <code class="literal">*</code> or <code class="literal">?</code>. This can increase
the iterations needed to find matching terms and slow search performance.</p></div></div>
</td></tr><tr><td valign="top">
<p><code class="literal">analyzer</code></p>
</td><td valign="top">
<p>Which analyzer should be used to normalize the <code class="literal">pattern</code>.  By default, the
search analyzer of the top-level field will be used.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">use_field</code></p>
</td><td valign="top">
<p>If specified, then match intervals from this field rather than the top-level field.
The <code class="literal">pattern</code> will be normalized using the search analyzer from this field, unless
<code class="literal">analyzer</code> is specified separately.</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="intervals-all_of"></a><code class="literal">all_of</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p><code class="literal">all_of</code> returns returns matches that span a combination of other rules.</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">intervals</code></p>
</td><td valign="top">
<p>An array of rules to combine.  All rules must produce a match in a
document for the overall source to match.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">max_gaps</code></p>
</td><td valign="top">
<p>Specify a maximum number of gaps between the rules.  Combinations that match
across a distance greater than this will not match.  If set to -1 or
unspecified, there is no restriction on this distance.  If set to 0, then the
matches produced by the rules must all appear immediately next to each other.</p>
</td></tr><tr><td valign="top">
<p><code class="literal">ordered</code></p>
</td><td valign="top">
<p>Whether the intervals produced by the rules should appear in the order in
which they are specified.  Defaults to <code class="literal">false</code></p>
</td></tr><tr><td valign="top">
<p><code class="literal">filter</code></p>
</td><td valign="top">
<p>An optional <a class="link" href="query-dsl-intervals-query.html#interval_filter" title="filters">interval filter</a></p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="intervals-any_of"></a><code class="literal">any_of</code><a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">any_of</code> rule emits intervals produced by any of its sub-rules.</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">intervals</code></p>
</td><td valign="top">
<p>An array of rules to match</p>
</td></tr><tr><td valign="top">
<p><code class="literal">filter</code></p>
</td><td valign="top">
<p>An optional <a class="link" href="query-dsl-intervals-query.html#interval_filter" title="filters">interval filter</a></p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="interval_filter"></a>filters<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You can filter intervals produced by any rules by their relation to the
intervals produced by another rule.  The following example will return
documents that have the words <code class="literal">hot</code> and <code class="literal">porridge</code> within 10 positions
of each other, without the word <code class="literal">salty</code> in between:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "match" : {
          "query" : "hot porridge",
          "max_gaps" : 10,
          "filter" : {
            "not_containing" : {
              "match" : {
                "query" : "salty"
              }
            }
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/324.console"></div><p>The following filters are available:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">
<p><code class="literal">containing</code></p>
</td><td valign="top">
<p>Produces intervals that contain an interval from the filter rule</p>
</td></tr><tr><td valign="top">
<p><code class="literal">contained_by</code></p>
</td><td valign="top">
<p>Produces intervals that are contained by an interval from the filter rule</p>
</td></tr><tr><td valign="top">
<p><code class="literal">not_containing</code></p>
</td><td valign="top">
<p>Produces intervals that do not contain an interval from the filter rule</p>
</td></tr><tr><td valign="top">
<p><code class="literal">not_contained_by</code></p>
</td><td valign="top">
<p>Produces intervals that are not contained by an interval from the filter rule</p>
</td></tr><tr><td valign="top">
<p><code class="literal">overlapping</code></p>
</td><td valign="top">
<p>Produces intervals that overlap with an interval from the filter rule</p>
</td></tr><tr><td valign="top">
<p><code class="literal">not_overlapping</code></p>
</td><td valign="top">
<p>Produces intervals that do not overlap with an interval from the filter rule</p>
</td></tr><tr><td valign="top">
<p><code class="literal">before</code></p>
</td><td valign="top">
<p>Produces intervals that appear before an interval from the filter role</p>
</td></tr><tr><td valign="top">
<p><code class="literal">after</code></p>
</td><td valign="top">
<p>Produces intervals that appear after an interval from the filter role</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="interval-script-filter"></a>Script filters<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You can also filter intervals based on their start position, end position and
internal gap count, using a script.  The script has access to an <code class="literal">interval</code>
variable, with <code class="literal">start</code>, <code class="literal">end</code> and <code class="literal">gaps</code> methods:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "match" : {
          "query" : "hot porridge",
          "filter" : {
            "script" : {
              "source" : "interval.start &gt; 10 &amp;&amp; interval.end &lt; 20 &amp;&amp; interval.gaps == 0"
            }
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/325.console"></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="interval-minimization"></a>Minimization<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/query-dsl/intervals-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The intervals query always minimizes intervals, to ensure that queries can
run in linear time.  This can sometimes cause surprising results, particularly
when using <code class="literal">max_gaps</code> restrictions or filters.  For example, take the
following query, searching for <code class="literal">salty</code> contained within the phrase <code class="literal">hot
porridge</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "match" : {
          "query" : "salty",
          "filter" : {
            "contained_by" : {
              "match" : {
                "query" : "hot porridge"
              }
            }
          }
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/326.console"></div><p>This query will <span class="strong strong"><strong>not</strong></span> match a document containing the phrase <code class="literal">hot porridge is
salty porridge</code>, because the intervals returned by the match query for <code class="literal">hot
porridge</code> only cover the initial two terms in this document, and these do not
overlap the intervals covering <code class="literal">salty</code>.</p><p>Another restriction to be aware of is the case of <code class="literal">any_of</code> rules that contain
sub-rules which overlap.  In particular, if one of the rules is a strict
prefix of the other, then the longer rule will never be matched, which can
cause surprises when used in combination with <code class="literal">max_gaps</code>.  Consider the
following query, searching for <code class="literal">the</code> immediately followed by <code class="literal">big</code> or <code class="literal">big bad</code>,
immediately followed by <code class="literal">wolf</code>:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "all_of" : {
          "intervals" : [
            { "match" : { "query" : "the" } },
            { "any_of" : {
                "intervals" : [
                    { "match" : { "query" : "big" } },
                    { "match" : { "query" : "big bad" } }
                ] } },
            { "match" : { "query" : "wolf" } }
          ],
          "max_gaps" : 0,
          "ordered" : true
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/327.console"></div><p>Counter-intuitively, this query <span class="strong strong"><strong>will not</strong></span> match the document <code class="literal">the big bad
wolf</code>, because the <code class="literal">any_of</code> rule in the middle will only produce intervals
for <code class="literal">big</code> - intervals for <code class="literal">big bad</code> being longer than those for <code class="literal">big</code>, while
starting at the same position, and so being minimized away.  In these cases,
it’s better to rewrite the query so that all of the options are explicitly
laid out at the top level:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "any_of" : {
          "intervals" : [
            { "match" : {
                "query" : "the big bad wolf",
                "ordered" : true,
                "max_gaps" : 0 } },
            { "match" : {
                "query" : "the big wolf",
                "ordered" : true,
                "max_gaps" : 0 } }
           ]
        }
      }
    }
  }
}</pre></div><div class="console_widget" data-snippet="snippets/328.console"></div></div></div><div class="navfooter"><span class="prev"><a href="full-text-queries.html">
              « 
              Full text queries</a>
           
        </span><span class="next">
           
          <a href="query-dsl-match-query.html">Match query
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
