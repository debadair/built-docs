<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Ranking Evaluation API
        | Elasticsearch Reference [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Reference [master]" /><link rel="up" href="search.html" title="Search APIs" /><link rel="prev" href="search-field-caps.html" title="Field Capabilities API" /><link rel="next" href="security-api.html" title="Security APIs" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Reference/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="rest-apis.html">REST APIs</a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Ranking Evaluation API</span></div><div class="navheader"><span class="prev"><a href="search-field-caps.html">
              « 
              Field Capabilities API</a>
           
        </span><span class="next">
           
          <a href="security-api.html">Security APIs
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-rank-eval"></a>Ranking Evaluation API<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png" /></div><div class="admon_content"><p>The ranking evaluation API is experimental and may be changed or removed completely in a future release, as well as change in non-backwards compatible ways on minor versions updates. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>The ranking evaluation API allows to evaluate the quality of ranked search
results over a set of typical search queries. Given this set of queries and a
list of manually rated documents, the <code class="literal">_rank_eval</code> endpoint calculates and
returns typical information retrieval metrics like <span class="emphasis"><em>mean reciprocal rank</em></span>,
<span class="emphasis"><em>precision</em></span> or <span class="emphasis"><em>discounted cumulative gain</em></span>.</p><h4><a id="_overview"></a>Overview<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Search quality evaluation starts with looking at the users of your search application, and the things that they are searching for.
Users have a specific <span class="emphasis"><em>information need</em></span>, e.g. they are looking for gift in a web shop or want to book a flight for their next holiday.
They usually enters some search terms into a search box or some other web form.
All of this information, together with meta information about the user (e.g. the browser, location, earlier preferences etc…​) then gets translated into a query to the underlying search system.</p><p>The challenge for search engineers is to tweak this translation process from user entries to a concrete query in such a way, that the search results contain the most relevant information with respect to the users information need.
This can only be done if the search result quality is evaluated constantly across a representative test suite of typical user queries, so that improvements in the rankings for one particular query doesn’t negatively effect the ranking for other types of queries.</p><p>In order to get started with search quality evaluation, three basic things are needed:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">a collection of documents you want to evaluate your query performance against, usually one or more indices</li><li class="listitem">a collection of typical search requests that users enter into your system</li><li class="listitem">a set of document ratings that judge the documents relevance with respect to a search request+
It is important to note that one set of document ratings is needed per test query, and that
the relevance judgements are based on the information need of the user that entered the query.</li></ol></div><p>The ranking evaluation API provides a convenient way to use this information in a ranking evaluation request to calculate different search evaluation metrics. This gives a first estimation of your overall search quality and give you a measurement to optimize against when fine-tuning various aspect of the query generation in your application.</p><h4><a id="_ranking_evaluation_request_structure"></a>Ranking evaluation request structure<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In its most basic form, a request to the <code class="literal">_rank_eval</code> endpoint has two sections:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /my_index/_rank_eval
{
    "requests": [ ... ], <a id="CO547-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
    "metric": { <a id="CO547-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
      "mean_reciprocal_rank": { ... } <a id="CO547-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
   }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO547-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>a set of typical search requests, together with their provided ratings</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO547-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>definition of the evaluation metric to calculate</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO547-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>a specific metric and its parameters</p></td></tr></table></div><p>The request section contains several search requests typical to your application, along with the document ratings for each particular search request, e.g.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">    "requests": [
        {
            "id": "amsterdam_query", <a id="CO548-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
            "request": { <a id="CO548-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                "query": { "match": { "text": "amsterdam" }}
            },
            "ratings": [ <a id="CO548-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
                 { "_index": "my_index", "_id": "doc1", "rating": 0 },
                 { "_index": "my_index", "_id": "doc2", "rating": 3},
                 { "_index": "my_index", "_id": "doc3", "rating": 1 }
            ]
        },
        {
            "id": "berlin_query",
            "request": {
                "query": { "match": { "text": "berlin" }}
            },
            "ratings": [
                { "_index": "my_index", "_id": "doc1", "rating": 1 }
            ]
        }
    ]</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO548-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the search requests id, used to group result details later</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO548-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the query that is being evaluated</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO548-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>a list of document ratings, each entry containing the documents <code class="literal">_index</code> and <code class="literal">_id</code> together with
the rating of the documents relevance with regards to this search request</p></td></tr></table></div><p>A document <code class="literal">rating</code> can be any integer value that expresses the relevance of the document on a user defined scale. For some of the metrics, just giving a binary rating (e.g. <code class="literal">0</code> for irrelevant and <code class="literal">1</code> for relevant) will be sufficient, other metrics can use a more fine grained scale.</p><h4><a id="_template_based_ranking_evaluation"></a>Template based ranking evaluation<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>As an alternative to having to provide a single query per test request, it is possible to specify query templates in the evaluation request and later refer to them. Queries with similar structure that only differ in their parameters don’t have to be repeated all the time in the <code class="literal">requests</code> section this way. In typical search systems where user inputs usually get filled into a small set of query templates, this helps making the evaluation request more succinct.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">GET /my_index/_rank_eval
{
   [...]
  "templates": [
     {
        "id": "match_one_field_query",  <a id="CO549-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "template": { <a id="CO549-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
            "inline": {
                "query": {
                  "match": { "{{field}}": { "query": "{{query_string}}" }}
                }
            }
        }
     }
  ],
  "requests": [
      {
         "id": "amsterdam_query",
         "ratings": [ ... ],
         "template_id": "match_one_field_query", <a id="CO549-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
         "params": { <a id="CO549-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
            "query_string": "amsterdam",
            "field": "text"
          }
     },
    [...]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO549-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the template id</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO549-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the template definition to use</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO549-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>a reference to a previously defined template</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO549-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the parameters to use to fill the template</p></td></tr></table></div><h4><a id="_available_evaluation_metrics"></a>Available evaluation metrics<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">metric</code> section determines which of the available evaluation metrics is going to be used.
Currently, the following metrics are supported:</p><h5><a id="k-precision"></a>Precision at K (P@k)<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>This metric measures the number of relevant results in the top k search results. Its a form of the well known <a class="ulink" href="https://en.wikipedia.org/wiki/Information_retrieval#Precision" target="_top">Precision</a> metric that only looks at the top k documents. It is the fraction of relevant documents in those first k
search. A precision at 10 (P@10) value of 0.6 then means six out of the 10 top hits are relevant with respect to the users information need.</p><p>P@k works well as a simple evaluation metric that has the benefit of being easy to understand and explain.
Documents in the collection need to be rated either as relevant or irrelevant with respect to the current query.
P@k does not take into account where in the top k results the relevant documents occur, so a ranking of ten results that
contains one relevant result in position 10 is equally good as a ranking of ten results that contains one relevant result in position 1.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET /twitter/_rank_eval
{
    "requests": [
    {
        "id": "JFK query",
        "request": { "query": { "match_all": {}}},
        "ratings": []
    }],
    "metric": {
      "precision": {
        "k" : 20,
        "relevant_rating_threshold": 1,
        "ignore_unlabeled": false
      }
   }
}</pre></div><div class="console_widget" data-snippet="snippets/1700.console"></div><p>The <code class="literal">precision</code> metric takes the following optional parameters</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">k</code></p></td><td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">relevant_rating_threshold</code></p></td><td align="left" valign="top"><p>sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code class="literal">1</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">ignore_unlabeled</code></p></td><td align="left" valign="top"><p>controls how unlabeled documents in the search results are counted.
If set to <span class="emphasis"><em>true</em></span>, unlabeled documents are ignored and neither count as relevant or irrelevant. Set to <span class="emphasis"><em>false</em></span> (the default), they are treated as irrelevant.</p></td></tr></tbody></table></div><h5><a id="_mean_reciprocal_rank"></a>Mean reciprocal rank<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>For every query in the test suite, this metric calculates the reciprocal of the rank of the
first relevant document. For example finding the first relevant result
in position 3 means the reciprocal rank is 1/3. The reciprocal rank for each query
is averaged across all queries in the test suite to give the <a class="ulink" href="https://en.wikipedia.org/wiki/Mean_reciprocal_rank" target="_top">mean reciprocal rank</a>.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET /twitter/_rank_eval
{
    "requests": [
    {
        "id": "JFK query",
        "request": { "query": { "match_all": {}}},
        "ratings": []
    }],
    "metric": {
        "mean_reciprocal_rank": {
            "k" : 20,
            "relevant_rating_threshold" : 1
        }
    }
}</pre></div><div class="console_widget" data-snippet="snippets/1701.console"></div><p>The <code class="literal">mean_reciprocal_rank</code> metric takes the following optional parameters</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">k</code></p></td><td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">relevant_rating_threshold</code></p></td><td align="left" valign="top"><p>Sets the rating threshold above which documents are considered to be
"relevant". Defaults to <code class="literal">1</code>.</p></td></tr></tbody></table></div><h5><a id="_discounted_cumulative_gain_dcg"></a>Discounted cumulative gain (DCG)<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>In contrast to the two metrics above, <a class="ulink" href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain" target="_top">discounted cumulative gain</a> takes both, the rank and the rating of the search results, into account.</p><p>The assumption is that highly relevant documents are more useful for the user when appearing at the top of the result list. Therefore, the DCG formula reduces the contribution that high ratings for documents on lower search ranks have on the overall DCG metric.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET /twitter/_rank_eval
{
    "requests": [
    {
        "id": "JFK query",
        "request": { "query": { "match_all": {}}},
        "ratings": []
    }],
    "metric": {
       "dcg": {
            "k" : 20,
            "normalize": false
       }
    }
}</pre></div><div class="console_widget" data-snippet="snippets/1702.console"></div><p>The <code class="literal">dcg</code> metric takes the following optional parameters:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">k</code></p></td><td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">normalize</code></p></td><td align="left" valign="top"><p>If set to <code class="literal">true</code>, this metric will calculate the <a class="ulink" href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG" target="_top">Normalized DCG</a>.</p></td></tr></tbody></table></div><h5><a id="_expected_reciprocal_rank_err"></a>Expected Reciprocal Rank (ERR)<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Expected Reciprocal Rank (ERR) is an extension of the classical reciprocal rank for the graded relevance case
(Olivier Chapelle, Donald Metzler, Ya Zhang, and Pierre Grinspan. 2009. <a class="ulink" href="http://olivier.chapelle.cc/pub/err.pdf" target="_top">Expected reciprocal rank for graded relevance</a>.)</p><p>It is based on the assumption of a cascade model of search, in which a user scans through ranked search
results in order and stops at the first document that satisfies the information need. For this reason, it
is a good metric for question answering and navigation queries, but less so for survey oriented information
needs where the user is interested in finding many relevant documents in the top k results.</p><p>The metric models the expectation of the reciprocal of the position at which a user stops reading through
the result list. This means that relevant document in top ranking positions will contribute much to the
overall score. However, the same document will contribute much less to the score if it appears in a lower rank,
even more so if there are some relevant (but maybe less relevant) documents preceding it.
In this way, the ERR metric discounts documents which are shown after very relevant documents. This introduces
a notion of dependency in the ordering of relevant documents that e.g. Precision or DCG don’t account for.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-console">GET /twitter/_rank_eval
{
    "requests": [
    {
        "id": "JFK query",
        "request": { "query": { "match_all": {}}},
        "ratings": []
    }],
    "metric": {
       "expected_reciprocal_rank": {
            "maximum_relevance" : 3,
            "k" : 20
       }
    }
}</pre></div><div class="console_widget" data-snippet="snippets/1703.console"></div><p>The <code class="literal">expected_reciprocal_rank</code> metric takes the following parameters:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">maximum_relevance</code></p></td><td align="left" valign="top"><p>Mandatory parameter. The highest relevance grade used in the user supplied
relevance judgments.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">k</code></p></td><td align="left" valign="top"><p>sets the maximum number of documents retrieved per query. This value will act in place of the usual <code class="literal">size</code> parameter
in the query. Defaults to 10.</p></td></tr></tbody></table></div><h4><a id="_response_format_3"></a>Response format<a href="https://github.com/elastic/elasticsearch/edit/master/docs/reference/search/rank-eval.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The response of the <code class="literal">_rank_eval</code> endpoint contains the overall calculated result for the defined quality metric,
a <code class="literal">details</code> section with a breakdown of results for each query in the test suite and an optional <code class="literal">failures</code> section
that shows potential errors of individual queries. The response has the following format:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
    "rank_eval": {
        "metric_score": 0.4, <a id="CO550-1"></a><span><img src="images/icons/callouts/1.png" alt="" /></span>
        "details": {
            "my_query_id1": { <a id="CO550-2"></a><span><img src="images/icons/callouts/2.png" alt="" /></span>
                "metric_score": 0.6, <a id="CO550-3"></a><span><img src="images/icons/callouts/3.png" alt="" /></span>
                "unrated_docs": [ <a id="CO550-4"></a><span><img src="images/icons/callouts/4.png" alt="" /></span>
                    {
                        "_index": "my_index",
                        "_id": "1960795"
                    }, [...]
                ],
                "hits": [
                    {
                        "hit": { <a id="CO550-5"></a><span><img src="images/icons/callouts/5.png" alt="" /></span>
                            "_index": "my_index",
                            "_type": "page",
                            "_id": "1528558",
                            "_score": 7.0556192
                        },
                        "rating": 1
                    }, [...]
                ],
                "metric_details": { <a id="CO550-6"></a><span><img src="images/icons/callouts/6.png" alt="" /></span>
                    "precision" : {
                        "relevant_docs_retrieved": 6,
                        "docs_retrieved": 10
                    }
                }
            },
            "my_query_id2" : { [...] }
        },
        "failures": { [...] }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO550-1"><span><img src="images/icons/callouts/1.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the overall evaluation quality calculated by the defined metric</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO550-2"><span><img src="images/icons/callouts/2.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the <code class="literal">details</code> section contains one entry for every query in the original <code class="literal">requests</code> section, keyed by the search request id</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO550-3"><span><img src="images/icons/callouts/3.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the <code class="literal">metric_score</code> in the <code class="literal">details</code> section shows the contribution of this query to the global quality metric score</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO550-4"><span><img src="images/icons/callouts/4.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the <code class="literal">unrated_docs</code> section contains an <code class="literal">_index</code> and <code class="literal">_id</code> entry for each document in the search result for this
query that didn’t have a ratings value. This can be used to ask the user to supply ratings for these documents</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO550-5"><span><img src="images/icons/callouts/5.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the <code class="literal">hits</code> section shows a grouping of the search results with their supplied rating</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO550-6"><span><img src="images/icons/callouts/6.png" alt="" /></span></a> </p></td><td valign="top" align="left"><p>the <code class="literal">metric_details</code> give additional information about the calculated quality metric (e.g. how many of the retrieved
documents where relevant). The content varies for each metric but allows for better interpretation of the results</p></td></tr></table></div></div><div class="navfooter"><span class="prev"><a href="search-field-caps.html">
              « 
              Field Capabilities API</a>
           
        </span><span class="next">
           
          <a href="security-api.html">Security APIs
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
