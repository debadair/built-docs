<!DOCTYPE html>
<html lang="en-us">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Using the EC2 discovery plugin
        | Elasticsearch Plugins and Integrations [master]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Elasticsearch Plugins and Integrations [master]" /><link rel="up" href="discovery-ec2.html" title="EC2 Discovery Plugin" /><link rel="prev" href="discovery-ec2.html" title="EC2 Discovery Plugin" /><link rel="next" href="cloud-aws-best-practices.html" title="Best Practices in AWS" /><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients." /><meta name="DC.type" content="Learn/Docs/Elasticsearch/Plugins/master" /><meta name="DC.subject" content="Elasticsearch" /><meta name="DC.identifier" content="master" />
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
    <meta name="apple-mobile-web-app-title" content="Elastic">
    <meta name="application-name" content="Elastic">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="naver-site-verification" content="936882c1853b701b3cef3721758d80535413dbfd" />
    <meta name="yandex-verification" content="d8a47e95d0972434" />
    <!-- DC tags section -->
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" >
    <link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" >
    
    <!-- end DC tags -->
    <meta name="description" content="" />
    <meta name="localized" content="true" />
    <meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- For third-generation iPad with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">
    <!-- For iPhone with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">
    <!-- For first- and second-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">
    <!-- css -->
    <link href="/static/css/main.css" rel="stylesheet">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
      // -------------------- set language based on browser language --------------------
      var lang = '/'+(navigator.language || navigator.userLanguage).slice(0,2)+'/',
      locales = {
        '/en':'/',
        '/de/': '/de/',
        '/fr/': '/fr/',
        '/ja/':'/jp/',
        '/ko/':'/kr/',
        '/zh/':'/cn/',
        '/es/': '/es/'
      },
      localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}',
      currentlocale = JSON.parse(localeUrl).relative_url_prefix;

      if($.cookie("is_lang_detected") == undefined){
        if(locales[lang] != undefined && locales[lang] != currentlocale){
          locale_lang_url = locales[lang] + window.location.pathname.slice(1,window.location.pathname.length);
          $.cookie("is_lang_detected",true ,{ path: '/'});
          window.location = locale_lang_url;
        }
      }
            
      // --------------------- end of set language based on browser language -----------------
    </script>
    <link type="text/css" rel="stylesheet" href="/static/css/guide.css" />
  
<link rel="stylesheet" type="text/css" href="styles.css" />

</head>

  <body>
    <!-- Google Tag Manager -->
    <script>dataLayer = [];</script><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-58RLH5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-58RLH5');</script>
    <!-- End Google Tag Manager -->
    
    <!-- new ga for staging server -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-12395217-16"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-12395217-16');
    </script>
    <!-- new ga for staging server -->

    <!-- Elastic APM -->
    <!--
    <script src="https://www.elastic.co/static/js/elastic-apm-js-base.umd.min.2.2.0.js"></script>
    <script type="text/javascript">
      var elasticApm = init({
        serviceName: 'elastic-co-frontend',
        serverUrl: 'https://3ddd1ee09cc242c4b169d36f5a2b8b77.apm.us-west1.gcp.cloud.es.io:443',
        stackTraceLimit: 5,
        serviceVersion: '1.0.0'
      })
    
      var pageLoadName
      var pathname = window.location.pathname.replace(/\/es|\/pt|\/jp|\/pt|\/fr|\/kr|\/cn|\/de/g, '')
      var parts = pathname.split('/');
    
      if (parts.length && parts[1] === 'blog') {
        if (parts.length === 2) {
          pageLoadName =  '/blog';
        }
        else if (parts[2] === 'category') {
          pageLoadName =  '/blog/category';
        }
        else if (parts[2] === 'archive') {
          pageLoadName =  '/blog/archive';
        }
        else {
          pageLoadName =  '/blog/detail';
        }
      }
      else if (parts.length && parts[1] === 'elasticon') {
        if (parts.length === 2) {
          pageLoadName =  '/elasticon';
        }
        else if (parts.length === 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/overview';
        }
        else if (parts.length > 5 && (parts[2] === 'conf' || parts[2] === 'tour')) {
          pageLoadName =  '/elasticon/video';
        }
      }
      else if (parts.length && parts[1] === 'guide') {
        pageLoadName =  '/guide';
      }
      else if (parts.length === 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos';
      }
      else if (parts.length > 2 && parts[1] === 'videos') {
        pageLoadName =  '/videos/detail';
      }
      else if (parts.length > 2 && parts[1] === 'webinars') {
        pageLoadName =  '/webinars/detail';
      }
      else {
        pageLoadName =  window.location.pathname;
      }
    
      console.log('apm pageLoadName:', pageLoadName, parts)
      elasticApm.setTags({env:"production"});
      elasticApm.setInitialPageLoadName(pageLoadName);
    </script>
    -->

    <!-- Header Section -->
    
    <div id='elastic-nav'></div>

    <!-- Subnav -->
    <div>
      <div>
        <div class="tertiary-nav d-none d-md-block">
          <div class="container">
            <div class="p-t-b-15 d-flex justify-content-between nav-container">
              <div class="breadcrum-wrapper"><span><a href="/guide/" style="font-size: 14px; font-weight: 600; color: #000;">Docs</a></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <link rel="stylesheet" type="text/css" href="/static/css/horizon-swiper.min.css">

    <style> 
      .m-shortcuts li a.m-search {
        background: url("/assets/blt7b9c4fe6528dc4ef/m-search-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-docs {
        background: url("/assets/blt44d8b7530a76d01c/m-guide-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}

      .m-shortcuts li a.m-contact {
        background: url("/assets/blt878040795c9d083b/m-contact-icon.png") no-repeat scroll center center rgba(0, 0, 0, 0);
        background-size: contain;}
    </style>

    <script type="text/javascript" src="/static/js/horizon-swiper.min.js"></script>

    <script type="text/javascript">
      $(document).ready( function(){
        // if($('#scrollable-pane li').length > 3){
          $('.horizon-swiper').horizonSwiper({
            showItems: 3,
            arrows: true
          }); 
        // }
        
        $('.navbar-toggle').on('click', function(){
          $('.mobile-navigation, .menu-open').hide();
          $('.navigation-wrapper').addClass('mobile-navigation');
          $('.navbar').addClass('menu-open');
          $('.menu-close').show();
        });
        $('.menu-close').on('click', function(){
          $('.navigation-wrapper').removeClass('mobile-navigation');
          $('.navbar').removeClass('menu-open');
          $('.menu-close').hide();
        });
    
        var active_url = "";
    
        $(".navbar-mobile-header-icon").click(function(index){
          $('.navigation-wrapper').toggleClass('menu-overlay');
          $(this).toggleClass("navbar-mobile-header-icon-click navbar-mobile-header-icon-out");
          $(".mobile-inner-nav").slideToggle(500);
          $(".mobile-inner-nav .navbar-nav a").each(function( index ) {
            $(this).css({'animation-delay': (index/25)+'0.4s'});
          });
        });
    
        $('.dropdown-btn').on('click', function(e){
          e.preventDefault();
          setDropdown();
        });
        
        function setDropdown() {
          $('#myDropdown').slideToggle();
        }
    
        $('body').on('click', function(event){
          if (!event.target.matches('.dropdown-btn')) {
    
            var dropdowns = $(".dropdown-content");
            var i;
            for (i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.classList.contains('show')) {
                openDropdown.classList.remove('show');
              }
            }
          }
        });
    
      });
      $(window).resize(function () {
        $('.horizon-swiper').horizonSwiper({
          showItems: 3,
          arrows: true
        });
      });
    </script>

    <div class="main-container">
      <section id="content" >
        <div class="content-wrapper">   

          <section id="guide" lang="en">
            <div class="container">
              <div class="row">
                <!-- start body -->
                
            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
            <!-- start body -->
<div class="page_header">You are looking at preliminary documentation for a future release.
Not what you want? See the
<a href="../current/index.html">current release documentation</a>.
</div><div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Plugins and Integrations
      [master]
    </a></span> » <span class="breadcrumb-link"><a href="discovery.html">Discovery Plugins</a></span> » <span class="breadcrumb-link"><a href="discovery-ec2.html">EC2 Discovery Plugin</a></span> » <span class="breadcrumb-node">Using the EC2 discovery plugin</span></div><div class="navheader"><span class="prev"><a href="discovery-ec2.html">
              « 
              EC2 Discovery Plugin</a>
           
        </span><span class="next">
           
          <a href="cloud-aws-best-practices.html">Best Practices in AWS
               »
            </a></span></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="discovery-ec2-usage"></a>Using the EC2 discovery plugin<a href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/discovery-ec2.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">discovery-ec2</code> plugin allows Elasticsearch to find the master-eligible nodes in a
cluster running on AWS EC2 by querying the
<a class="ulink" href="https://github.com/aws/aws-sdk-java" target="_top">AWS API</a> for the addresses of the EC2
instances running these nodes.</p><p>It is normally a good idea to restrict the discovery process just to the
master-eligible nodes in the cluster. This plugin allows you to identify these
nodes by certain criteria including their tags, their membership of security
groups, and their placement within availability zones. The discovery process
will work correctly even if it finds master-ineligible nodes, but master
elections will be more efficient if this can be avoided.</p><p>The interaction with the AWS API can be authenticated using the
<a class="ulink" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" target="_top">instance
role</a>, or else custom credentials can be supplied.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_enabling_ec2_discovery"></a>Enabling EC2 discovery<a href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/discovery-ec2.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>To enable EC2 discovery, configure Elasticsearch to use the <code class="literal">ec2</code> seed hosts provider:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">discovery.seed_providers: ec2</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_configuring_ec2_discovery"></a>Configuring EC2 discovery<a href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/discovery-ec2.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>EC2 discovery supports a number of settings. Some settings are sensitive and
must be stored in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">Elasticsearch keystore</a>. For example,
to authenticate using a particular access key and secret key, add these keys to
the keystore by running the following commands:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-sh">bin/elasticsearch-keystore add discovery.ec2.access_key
bin/elasticsearch-keystore add discovery.ec2.secret_key</pre></div><p>The available settings for the EC2 discovery plugin are as follows.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">discovery.ec2.access_key</code></span></dt><dd>An EC2 access key. If set, you must also set <code class="literal">discovery.ec2.secret_key</code>.
If unset, <code class="literal">discovery-ec2</code> will instead use the instance role. This setting
is sensitive and must be stored in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">Elasticsearch
keystore</a>.</dd><dt><span class="term"><code class="literal">discovery.ec2.secret_key</code></span></dt><dd>An EC2 secret key. If set, you must also set <code class="literal">discovery.ec2.access_key</code>.
This setting is sensitive and must be stored in the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">Elasticsearch keystore</a>.</dd><dt><span class="term"><code class="literal">discovery.ec2.session_token</code></span></dt><dd>An EC2 session token. If set, you must also set <code class="literal">discovery.ec2.access_key</code>
and <code class="literal">discovery.ec2.secret_key</code>. This setting is sensitive and must be
stored in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">Elasticsearch keystore</a>.</dd><dt><span class="term"><code class="literal">discovery.ec2.endpoint</code></span></dt><dd>The EC2 service endpoint to which to connect. See
<a class="ulink" href="http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region" target="_top">http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region</a> to find
the appropriate endpoint for the region. This setting defaults to
<code class="literal">ec2.us-east-1.amazonaws.com</code> which is appropriate for clusters running in
the <code class="literal">us-east-1</code> region.</dd><dt><span class="term"><code class="literal">discovery.ec2.protocol</code></span></dt><dd>The protocol to use to connect to the EC2 service endpoint, which may be
either <code class="literal">http</code> or <code class="literal">https</code>. Defaults to <code class="literal">https</code>.</dd><dt><span class="term"><code class="literal">discovery.ec2.proxy.host</code></span></dt><dd>The address or host name of an HTTP proxy through which to connect to EC2.
If not set, no proxy is used.</dd><dt><span class="term"><code class="literal">discovery.ec2.proxy.port</code></span></dt><dd>When the address of an HTTP proxy is given in <code class="literal">discovery.ec2.proxy.host</code>,
this setting determines the port to use to connect to the proxy. Defaults to
<code class="literal">80</code>.</dd><dt><span class="term"><code class="literal">discovery.ec2.proxy.username</code></span></dt><dd>When the address of an HTTP proxy is given in <code class="literal">discovery.ec2.proxy.host</code>,
this setting determines the username to use to connect to the proxy. When
not set, no username is used. This setting is sensitive and must be stored
in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">Elasticsearch keystore</a>.</dd><dt><span class="term"><code class="literal">discovery.ec2.proxy.password</code></span></dt><dd>When the address of an HTTP proxy is given in <code class="literal">discovery.ec2.proxy.host</code>,
this setting determines the password to use to connect to the proxy. When
not set, no password is used. This setting is sensitive and must be stored
in the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html" target="_top">Elasticsearch keystore</a>.</dd><dt><span class="term"><code class="literal">discovery.ec2.read_timeout</code></span></dt><dd>The socket timeout for connections to EC2,
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/common-options.html#time-units" target="_top">including the units</a>. For example, a
value of <code class="literal">60s</code> specifies a 60-second timeout. Defaults to 50 seconds.</dd><dt><span class="term"><code class="literal">discovery.ec2.groups</code></span></dt><dd>A list of the names or IDs of the security groups to use for discovery. The
<code class="literal">discovery.ec2.any_group</code> setting determines the behaviour of this setting.
Defaults to an empty list, meaning that security group membership is
ignored by EC2 discovery.</dd><dt><span class="term"><code class="literal">discovery.ec2.any_group</code></span></dt><dd>Defaults to <code class="literal">true</code>, meaning that instances belonging to <span class="emphasis"><em>any</em></span> of the
security groups specified in <code class="literal">discovery.ec2.groups</code> will be used for
discovery. If set to <code class="literal">false</code>, only instances that belong to <span class="emphasis"><em>all</em></span> of the
security groups specified in <code class="literal">discovery.ec2.groups</code> will be used for
discovery.</dd><dt><span class="term"><code class="literal">discovery.ec2.host_type</code></span></dt><dd><p class="simpara">Each EC2 instance has a number of different addresses that might be suitable
for discovery. This setting allows you to select which of these addresses is
used by the discovery process. It can be set to one of <code class="literal">private_ip</code>,
<code class="literal">public_ip</code>, <code class="literal">private_dns</code>, <code class="literal">public_dns</code> or <code class="literal">tag:TAGNAME</code> where <code class="literal">TAGNAME</code>
refers to a name of a tag. This setting defaults to <code class="literal">private_ip</code>.</p><p class="simpara">If you set <code class="literal">discovery.ec2.host_type</code> to a value of the form <code class="literal">tag:TAGNAME</code> then
the value of the tag <code class="literal">TAGNAME</code> attached to each instance will be used as that
instance’s address for discovery. Instances which do not have this tag set will
be ignored by the discovery process.</p><p class="simpara">For example if you tag some EC2 instances with a tag named
<code class="literal">elasticsearch-host-name</code> and set <code class="literal">host_type: tag:elasticsearch-host-name</code> then
the <code class="literal">discovery-ec2</code> plugin will read each instance’s host name from the value
of the <code class="literal">elasticsearch-host-name</code> tag.
<a class="ulink" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html" target="_top">Read more
about EC2 Tags</a>.</p></dd><dt><span class="term"><code class="literal">discovery.ec2.availability_zones</code></span></dt><dd>A list of the names of the availability zones to use for discovery. The
name of an availability zone is the
<a class="ulink" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html" target="_top">region
code followed by a letter</a>, such as <code class="literal">us-east-1a</code>. Only instances placed in
one of the given availability zones will be used for discovery.</dd></dl></div><div class="variablelist"><a id="discovery-ec2-filtering"></a><dl class="variablelist"><dt><span class="term"><code class="literal">discovery.ec2.tag.TAGNAME</code></span></dt><dd><p class="simpara">A list of the values of a tag called <code class="literal">TAGNAME</code> to use for discovery. If set,
only instances that are tagged with one of the given values will be used for
discovery. For instance, the following settings will only use nodes with a
<code class="literal">role</code> tag set to <code class="literal">master</code> and an <code class="literal">environment</code> tag set to either <code class="literal">dev</code> or
<code class="literal">staging</code>.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">discovery.ec2.tag.role: master
discovery.ec2.tag.environment: dev,staging</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png" /></div><div class="admon_content"><p>The names of tags used for discovery may only contain ASCII letters,
numbers, hyphens and underscores. In particular you cannot use tags whose name
includes a colon.</p></div></div></dd><dt><span class="term"><code class="literal">discovery.ec2.node_cache_time</code></span></dt><dd>Sets the length of time for which the collection of discovered instances is
cached. Elasticsearch waits at least this long between requests for discovery
information from the EC2 API. AWS may reject discovery requests if they are
made too often, and this would cause discovery to fail. Defaults to <code class="literal">10s</code>.</dd></dl></div><p>All <span class="strong strong"><strong>secure</strong></span> settings of this plugin are
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/secure-settings.html#reloadable-secure-settings" target="_top">reloadable</a>, allowing you
to update the secure settings for this plugin without needing to restart each
node.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-ec2-permissions"></a>Recommended EC2 permissions<a href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/discovery-ec2.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">discovery-ec2</code> plugin works by making a <code class="literal">DescribeInstances</code> call to the AWS
EC2 API. You must configure your AWS account to allow this, which is normally
done using an IAM policy. You can create a custom policy via the IAM Management
Console. It should look similar to this.</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-js">{
  "Statement": [
    {
      "Action": [
        "ec2:DescribeInstances"
      ],
      "Effect": "Allow",
      "Resource": [
        "*"
      ]
    }
  ],
  "Version": "2012-10-17"
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-ec2-attributes"></a>Automatic node attributes<a href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/discovery-ec2.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">discovery-ec2</code> plugin can automatically set the <code class="literal">aws_availability_zone</code>
node attribute to the availability zone of each node. This node attribute
allows you to ensure that each shard has copies allocated redundantly across
multiple availability zones by using the
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/allocation-awareness.html" target="_top">Allocation Awareness</a> feature.</p><p>In order to enable the automatic definition of the <code class="literal">aws_availability_zone</code>
attribute, set <code class="literal">cloud.node.auto_attributes</code> to <code class="literal">true</code>. For example:</p><div class="pre_wrapper"><pre class="programlisting prettyprint lang-yaml">cloud.node.auto_attributes: true
cluster.routing.allocation.awareness.attributes: aws_availability_zone</pre></div><p>The <code class="literal">aws_availability_zone</code> attribute can be automatically set like this when
using any discovery type. It is not necessary to set <code class="literal">discovery.seed_providers:
ec2</code>. However this feature does require that the <code class="literal">discovery-ec2</code> plugin is
installed.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="discovery-ec2-network-host"></a>Binding to the correct address<a href="https://github.com/elastic/elasticsearch/edit/master/docs/plugins/discovery-ec2.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It is important to define <code class="literal">network.host</code> correctly when deploying a cluster on
EC2. By default each Elasticsearch node only binds to <code class="literal">localhost</code>, which will prevent it
from being discovered by nodes running on any other instances.</p><p>You can use the <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-network.html" target="_top">core network host settings</a> to bind
each node to the desired address, or you can set <code class="literal">network.host</code> to one of the
following EC2-specific settings provided by the <code class="literal">discovery-ec2</code> plugin:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">EC2 Host Value</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal">_ec2:privateIpv4_</code></p></td><td align="left" valign="top"><p>The private IP address (ipv4) of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:privateDns_</code></p></td><td align="left" valign="top"><p>The private host of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:publicIpv4_</code></p></td><td align="left" valign="top"><p>The public IP address (ipv4) of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:publicDns_</code></p></td><td align="left" valign="top"><p>The public host of the machine.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:privateIp_</code></p></td><td align="left" valign="top"><p>Equivalent to <code class="literal">_ec2:privateIpv4_</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2:publicIp_</code></p></td><td align="left" valign="top"><p>Equivalent to <code class="literal">_ec2:publicIpv4_</code>.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal">_ec2_</code></p></td><td align="left" valign="top"><p>Equivalent to <code class="literal">_ec2:privateIpv4_</code>.</p></td></tr></tbody></table></div><p>These values are acceptable when using any discovery type. They do not require
you to set <code class="literal">discovery.seed_providers: ec2</code>. However they do require that the
<code class="literal">discovery-ec2</code> plugin is installed.</p></div></div><div class="navfooter"><span class="prev"><a href="discovery-ec2.html">
              « 
              EC2 Discovery Plugin</a>
           
        </span><span class="next">
           
          <a href="cloud-aws-best-practices.html">Best Practices in AWS
               »
            </a></span></div>
<!-- end body -->

            </div>
            <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
        
                  <div id="rtpcontainer" style="display: block;">
                    <div class="mktg-promo">
                      <h3>Getting Started Videos</h3>
                      <ul class="icons">
                        <li class="icon-elasticsearch-white"><a href="https://www.elastic.co/webinars/getting-started-elasticsearch?baymax=default&elektra=docs&storm=top-video">Starting Elasticsearch</a></li>
                        <li class="icon-kibana-white"><a href="https://www.elastic.co/webinars/getting-started-kibana?baymax=default&elektra=docs&storm=top-video">Introduction to Kibana</a></li>
                        <li class="icon-logstash-white"><a href="https://www.elastic.co/webinars/getting-started-logstash?baymax=default&elektra=docs&storm=top-video">Logstash Starter Guide</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

        </div>


<div id='elastic-footer'</div>
<!-- Footer Section end-->

<script src='https://www.elastic.co/elastic-nav.js'></script>
<script src='https://www.elastic.co/elastic-footer.js'></script>

<style type="text/css">
	
        
            .Facebook a {background:url("/assets/bltf546ff2e0a8f2de5/facebook.svg") no-repeat;}
            .Facebook a:before {
                content: url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Facebook a:hover {background:url("/assets/bltc24cf11c714ecfc4/facebook-hover.svg")}		
        
	
        
            .Twitter a {background:url("/assets/bltdd9556d6b24e2b85/twitter.svg") no-repeat;}
            .Twitter a:before {
                content: url("/assets/blt90b0372cc07a54d3/twitter-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Twitter a:hover {background:url("/assets/blt90b0372cc07a54d3/twitter-hover.svg")}		
        
	
        
            .LinkedIn a {background:url("/assets/bltc4a77e0f52ce07f1/linkedin.svg") no-repeat;}
            .LinkedIn a:before {
                content: url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .LinkedIn a:hover {background:url("/assets/blt01ce654380e4ea6c/linkedin-hover.svg")}		
        
	
        
            .Xing a {background:url("/assets/bltc6347078dcc9ec76/xing.svg") no-repeat;}
            .Xing a:before {
                content: url("/assets/bltededebe5f7521a39/xing-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .Xing a:hover {background:url("/assets/bltededebe5f7521a39/xing-hover.svg")}		
        
	
        
            .YouTube a {background:url("/assets/blt4982061ce1aebc7f/youtube.svg") no-repeat;}
            .YouTube a:before {
                content: url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg");
                width:0;
                height:0;
                visibility:hidden;
            }
        
        
            .YouTube a:hover {background:url("/assets/bltddeb6c6404ae81a5/youtube-hover.svg")}		
        
	
</style>

<script src="//app-lon02.marketo.com/js/forms2/js/forms2.min.js"></script>
<script>
$(document).ready(function(){

    var ipSuccess = function(data) {
        country = data.country_code;
        if (data.in_eu){
                        
            marketo_id = "6196";
            
        }else{ 
            marketo_id = "1398";

        }

        $('.subscribe-form form.sb-form').attr('id', 'mktoForm_' + marketo_id);
        if(window.MktoForms2){
            MktoForms2.loadForm("//app-lon02.marketo.com", "813-MAM-392", marketo_id,function(form){
                form.onSuccess(function(form){
                    $('#mktoForm_'+marketo_id).css('display','none');
                    $('.subscribe-wrapper .subscribe-form-container').hide();
                    $('.subscribe-wrapper').find('.form_thanks').removeClass('hide')
                    dataLayer.push({'event': 'mktoFormSubmit'});
                    return false;
                });
            });  
        }
    }

    var marketo_id;

    $.ajax({
        url: "/gdpr-data"
    }).success(function(data) {
        ipSuccess(data);
    });

})
</script>

      </section>
    </div>

    
     <script type="text/javascript">
	var suggestionsUrl = "https://search.elastic.co/suggest";
	var localeUrl = '{"relative_url_prefix":"/","code":"en-us","display_code":"en-us","url":"/guide_template"}';
</script>
<script src="/static/js/swiftype_app_search.umd.min.js"></script>
<script src="/static/js/jquery.autocomplete.js"></script>
<script type="text/javascript" src="/static/js/slick.min.js"></script>
<script src="/static/js/nav-v5.js"></script>
<script src="/static/js/script.js"></script>
 
     
<script type="text/javascript">
$(document).ready(function(){
	if (window.location.hash.length) {
	      var target = $(window.location.hash);
	      target = target.length ? target : $(window.location.hash);
	      if (target.length) {
	        setTimeout(function(){ $(window).scrollTop(target.offset().top - 60); }, 1200);        
	      }
	}
	$('#guide').on('click','a[href*=#]:not([href=#])',function(e) {
			var flag=true;
		      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
		          var target = $(this.hash);
		          target = target.length ? target :$(this.hash);
		          if (target.length) {
		            if(flag){
		              flag=false;
		              var heightScroll=($('.tertiary-nav.navbar-fixed-top').height())?60:110;
		              $('html,body').animate({
		                  scrollTop: target.offset().top - heightScroll
		                }, 2000, function(){
		                  flag=true;
		                });
		            }                    
		          }
		      }
		    
	});

})

</script>

     <style></style>
     
  
            <script type="text/javascript" src="docs.js"></script>
<script type='text/javascript' src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=yaml'></script>

            </body>
        
</html>
